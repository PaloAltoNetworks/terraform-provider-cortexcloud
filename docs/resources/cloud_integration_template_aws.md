---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "cortexcloud_cloud_integration_template_aws Resource - Cortex Cloud Provider"
subcategory: ""
description: |-
  Manages a cloud onboarding integration template for AWS.
---

# cortexcloud_cloud_integration_template_aws (Resource)

Manages a cloud onboarding integration template for AWS.

## Example Usage

```terraform
# AWS account onboarding template that is automatically deployed using the AWS 
# Terraform Provider.
# 
# This template will be created with the following configuration:
#   - Instance name of `AWS Account`
#   - All AWS regions in scanning scope
#   - All additional capabilities enabled
#       - Registry scanning configured to scan only container images that were
#         created or modified in the last 7 days within the discovered ECR 
#         repositories
#   - Audit log collection enabled 
#       - Using a custom (user-defined) collection method
#   - No additional tags will be applied to Cortex Cloud resources other
#     than the "managed_by" tag with the value "paloaltonetworks", which is
#     applied by default
#
# After creation, this template will be deployed as a CloudFormation stack in 
# the target AWS environment. See AWS Terraform provider documentation page for
# the `aws_cloudformation_stack` resource for more information.
resource "cortexcloud_cloud_integration_template_aws" "account_auto_deploy" {
  scope         = "ACCOUNT"
  instance_name = "AWS Account"
  scan_mode     = "MANAGED"
  scope_modifications = {
    regions = {
      enabled = false
    }
  }
  additional_capabilities = {
    data_security_posture_management = true
    registry_scanning                = true
    registry_scanning_options = {
      type      = "TAGS_MODIFIED_DAYS"
      last_days = 7
    }
    xsiam_analytics         = true
    agentless_disk_scanning = true
  }
  collection_configuration = {
    audit_logs = {
      enabled           = true
      collection_method = "CUSTOM"
    }
  }
}

# Using the value of the template resource's `cloudformation_template_url` 
# attribute as the argument for the CloudFormation stack resource's
# `template_url` attribute.
#
# Note: the `CAPABILITY_NAMED_IAM` capability is required in order to
# successfully deploy the CloudFormation stack.
resource "aws_cloudformation_stack" "cortex_cloud_account_integration" {
  name         = "cortex-cloud"
  template_url = resource.cortexcloud_cloud_integration_template_aws.account_auto_deploy.cloudformation_template_url
  capabilities = ["CAPABILITY_NAMED_IAM"] // Required
}
```

```terraform
# AWS account onboarding template.
#
# This template will be created with the following configuration:
#   - Instance name of "AWS Account"
#   - Scans scoped to the us-east-1 and us-east-2 regions
#   - All additional capabilities enabled
#       - Registry scanning configured to initially scan all discovered 
#         container images, including all versions (tags), in all discovered
#         ECR repositories
#   - Audit log collection enabled 
#       - Using the automated collection method
#       - Data event logs will not be collected
#   - The "environment" tag with the value "production" will be applied to all 
#     resources created by Cortex Cloud in the target AWS environment
#       - An additional "managed_by" tag with the value "paloaltonetworks" is
#         applied by default for all onboarded CSP environments
resource "cortexcloud_cloud_integration_template_aws" "account" {
  scope         = "ACCOUNT"
  instance_name = "AWS Account"
  # TODO: change to outpost
  scan_mode = "MANAGED"
  scope_modifications = {
    regions = {
      enabled = true
      type    = "INCLUDE"
      regions = [
        "us-east-1",
        "us-east-2",
      ]
    }
  }
  additional_capabilities = {
    data_security_posture_management = true
    registry_scanning                = true
    registry_scanning_options = {
      type = "ALL"
    }
    xsiam_analytics         = true
    agentless_disk_scanning = true
  }
  collection_configuration = {
    audit_logs = {
      enabled           = true
      collection_method = "AUTOMATED"
      data_events       = false
    }
  }
  custom_resources_tags = [
    {
      key   = "environment"
      value = "production"
    },
  ]
}
```

```terraform
# AWS account group onboarding template.
#
# This template will be created with the following configuration:
#   - Instance name of "AWS Account Group"
#   - Scans scoped to the us-east-1 region 
#   - all additional capabilities enabled
#       - registry scanning configured to initially scan all discovered 
#         registries 
#   - audit log collection enabled 
#       - using the automated collection method
#       - Data event logs will not be collected
#   - apply the `environment` tag with the value `production` to all resources
#     created by Cortex in the target AWS environment
resource "cortexcloud_cloud_integration_template_aws" "organization" {
  scope         = "ORGANIZATION"
  instance_name = "AWS Account Group"
  scan_mode     = "MANAGED"
  scope_modifications = {
    accounts = {
      enabled = true
      type    = "INCLUDE"
      account_ids = [
        "012345678901",
        "345678901234",
      ]
    }
    regions = {
      enabled = true
      type    = "EXCLUDE"
      regions = [
        "us-west-1",
        "ca-central-1",
      ]
    }
  }
  additional_capabilities = {
    data_security_posture_management = true
    registry_scanning                = true
    registry_scanning_options = {
      type = "LATEST_TAG"
    }
    xsiam_analytics         = true
    agentless_disk_scanning = true
  }
  collection_configuration = {
    audit_logs = {
      enabled           = true
      collection_method = "AUTOMATED"
      data_events       = true
    }
  }
  custom_resources_tags = [
    {
      key   = "cost_center"
      value = "555123"
    },
    {
      key   = "department"
      value = "marketing"
    },
  ]
}
```

```terraform
# AWS account template with only required values defined.
#
# This template will be created with the following configuration:
#   - No instance name
#   - All AWS regions in scanning scope
#   - All additional capabilities except Data Security Posture Management 
#     enabled
#       - Registry scanning configured to initially scan all discovered 
#         container images, including all versions (tags), in all discovered
#         ECR repositories
#   - Audit log collection enabled 
#       - Using the automated collection method
#       - Data event logs will not be collected
#   - No additional tags will be applied to Cortex Cloud resources other
#     than the "managed_by" tag with the value "paloaltonetworks", which is
#     applied by default
#
# These default values are equivaluent to the default values that are used when 
# creating this type of template in the Cortex Cloud console. See schema 
# section for more information.
resource "cortexcloud_cloud_integration_template_aws" "account_minimum_config" {
  scope     = "ACCOUNT"
  scan_mode = "MANAGED"
}
```

```terraform
# AWS organization onboarding template.
#
# This template will be created with the following configuration:
#   - Instance name of "AWS Organization"
#   - Scans scoped to the us-east-1 region 
#   - all additional capabilities enabled
#       - registry scanning configured to initially scan all discovered 
#         registries 
#   - audit log collection enabled 
#       - using the automated collection method
#       - Data event logs will not be collected
#   - apply the `environment` tag with the value `production` to all resources
#     created by Cortex in the target AWS environment
resource "cortexcloud_cloud_integration_template_aws" "organization" {
  scope         = "ORGANIZATION"
  instance_name = "AWS Organization"
  scan_mode     = "MANAGED"
  scope_modifications = {
    accounts = {
      enabled = true
      type    = "EXCLUDE"
      account_ids = [
        "012345678901",
        "345678901234",
      ]
    }
    regions = {
      enabled = true
      type    = "EXCLUDE"
      regions = [
        "us-west-1",
        "ca-central-1",
      ]
    }
  }
  additional_capabilities = {
    data_security_posture_management = true
    registry_scanning                = true
    registry_scanning_options = {
      type = "LATEST_TAG"
    }
    xsiam_analytics         = true
    agentless_disk_scanning = true
  }
  collection_configuration = {
    audit_logs = {
      enabled           = true
      collection_method = "AUTOMATED"
      data_events       = true
    }
  }
  custom_resources_tags = [
    {
      key   = "cost_center"
      value = "555123"
    },
    {
      key   = "department"
      value = "marketing"
    },
  ]
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `scan_mode` (String) Define what infrastructure the integration will use to scan cloud workloads. If set to `MANAGED`, scanning will be done in the Cortex Cloud environment. If set to `OUTPOST`, scanning will be done on infrastructure deployed to a cloud account owned by you. Possible values are: `MANAGED`, `OUTPOST`. 

~>**NOTE** Scanning with an outpost may require additional CSP permissions and may incur additional costs.
- `scope` (String) Define the scope for this integration instance. Possible values are: `ACCOUNT`, `ACCOUNT_GROUP`, `ORGANIZATION`

### Optional

- `additional_capabilities` (Attributes) Define which additional security capabilities to enable. 

~>**NOTE** that adding additional capabilities typically requires additional cloud provider permissions. For more information, refer to the [Cortex Cloud Posture Management documentation](https://docs-cortex.paloaltonetworks.com/r/Cortex-CLOUD/Cortex-Cloud-Posture-Management-Documentation/Cloud-service-provider-permissions). (see [below for nested schema](#nestedatt--additional_capabilities))
- `collection_configuration` (Attributes) Configure log data collection. (see [below for nested schema](#nestedatt--collection_configuration))
- `custom_resources_tags` (Attributes Set) Tags applied to any new resource created by Cortex Cloud in the cloud environment.

The tag `managed_by` with the value `paloaltonetworks` will be applied by default. (see [below for nested schema](#nestedatt--custom_resources_tags))
- `instance_name` (String) The name of the integration template. When the template is executed, integrations will appear in the console with this value.
- `outpost_id` (String) The ID of the outpost that will be used for scanning. Must be configured if `scan_mode` is set to `OUTPOST`.
- `scope_modifications` (Attributes) Define the scope of scans by including/excluding accounts or regions. (see [below for nested schema](#nestedatt--scope_modifications))

### Read-Only

- `automated_deployment_url` (String) The full URL returned by Cortex Cloud when selecting the automated method of executing the template. Opening this URL in your browser will take you to the AWS CloudFormation stack creation wizard where you can deploy the stack to permit Cortex Cloud to scan your AWS resources.

~>**NOTE** This option requires you to already be logged into the AWS console.
- `cloudformation_template_url` (String) The direct link to the CloudFormation template parsed from the `manual_deployment_url` attribute. This value may be supplied to the AWS Terraform Provider's `aws_cloudformation_stack` resource for automatic execution. For more information, refer to the official AWS Terraform Provider's documentation and the examples listed in this page.
- `manual_deployment_url` (String) The full URL returned by Cortex Cloud when selecting the manual method of executing the template. Opening this URL in your browser will begin a download of the created template as a CloudFormation stack, which you can then deploy to permit Cortex Cloud to scan your AWS resources.
- `status` (String) Status of the template.
- `tracking_guid` (String) The unique ID value assigned to this template after creation.

<a id="nestedatt--additional_capabilities"></a>
### Nested Schema for `additional_capabilities`

Optional:

- `agentless_disk_scanning` (Boolean) Whether to enable agentless disk scanning to remotely detect and remediate vulnerabilities during the development lifecycle. Default value is `true`.

It is strongly recommended that you keep enable this feature enabled.
- `data_security_posture_management` (Boolean) Whether to enable data security posture management, an agentless data security scanner that discovers, classifies, protects, and governs sensitive data. Default value is `true`.
- `registry_scanning` (Boolean) Whether to enable registry scanning, a container registry scanner that scans registry images for vulnerabilities, malware, and secrets. Default value is `true`.
- `registry_scanning_options` (Attributes) Additional configuration options forregistry scanning. (see [below for nested schema](#nestedatt--additional_capabilities--registry_scanning_options))
- `serverless_scanning` (Boolean) Whether to enable agentless disk scanning to remotely detect and remediate vulnerabilities during the development lifecycle. Default value is `true`.
- `xsiam_analytics` (Boolean) Whether to enable XSIAM analytics to analyze your endpoint data to develop a baseline and raise Analytics and Analytics BIOC alerts when anomalies and malicious behaviors are detected. Default value is `true`.

<a id="nestedatt--additional_capabilities--registry_scanning_options"></a>
### Nested Schema for `additional_capabilities.registry_scanning_options`

Required:

- `type` (String) Type of registry scanning.

Optional:

- `last_days` (Number) Number of days within which the tags on a registry image must have been created or updated for the image to be scanned. Minimum value is 0 and maximum value is 90. Cannot be configured if `type` is not set to `TAGS_MODIFIED_DAYS`.



<a id="nestedatt--collection_configuration"></a>
### Nested Schema for `collection_configuration`

Required:

- `audit_logs` (Attributes) Configuration for audit logs collection. (see [below for nested schema](#nestedatt--collection_configuration--audit_logs))

<a id="nestedatt--collection_configuration--audit_logs"></a>
### Nested Schema for `collection_configuration.audit_logs`

Optional:

- `collection_method` (String) Method of audit log collection. Default value is `AUTOMATED`.
- `data_events` (Boolean) Whether to collect data events as part of audit log collection. Default value is `false`.
- `enabled` (Boolean) Whether to enable audit log collection. Default value is `true`.



<a id="nestedatt--custom_resources_tags"></a>
### Nested Schema for `custom_resources_tags`

Required:

- `key` (String) The tag key.
- `value` (String) The tag value.


<a id="nestedatt--scope_modifications"></a>
### Nested Schema for `scope_modifications`

Optional:

- `accounts` (Attributes) Configuration for account-level scope modifications for AWS integrations. (see [below for nested schema](#nestedatt--scope_modifications--accounts))
- `regions` (Attributes) Configuration for scoping scans to specific regions or excluding specific regions from scans. (see [below for nested schema](#nestedatt--scope_modifications--regions))

<a id="nestedatt--scope_modifications--accounts"></a>
### Nested Schema for `scope_modifications.accounts`

Required:

- `enabled` (Boolean) Whether to enable this scope modification. Cannot be set to `true` if scope is set to `ACCOUNT`. If enabled, the `type` and `account_ids` attributes must be configured as well.

Optional:

- `account_ids` (Set of String) Account IDs to include or exclude from scans. Cannot be configured if scope is set to `ACCOUNT`. If scope is set to `ORGANIZATION` or `ACCOUNT_GROUP` and enabled is set to `true`, it must be configured with at least 1 value.
- `type` (String) Whether the specified account IDs should be included in the scope or excluded from the scope. Must be configured if `enabled` is set to `true` and scope is not set to `ACCOUNT`. Possible values are: `INCLUDE`, `EXCLUDE`


<a id="nestedatt--scope_modifications--regions"></a>
### Nested Schema for `scope_modifications.regions`

Required:

- `enabled` (Boolean) Whether to enable this scope modification. If set to `true`, the `type` and `regions` attributes must be configured as well.

Optional:

- `regions` (Set of String) Regions to include or exclude from scans. Must be configured with at least 1 value if `enabled` is set to `true`.
- `type` (String) Whether the specified regions should be included in the scope or excluded from the scope. Must be configured if `enabled` is set to `true`. Possible values are: `INCLUDE`, `EXCLUDE`
